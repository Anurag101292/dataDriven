name: Scheduled Test Runs

on:
  schedule:
    # 3:00 PM IST = 09:30 UTC → Prod validation
    - cron: "30 9 * * *"

    # 4:00 PM IST = 10:30 UTC → Regression
    - cron: "30 10 * * *"

    # 10:00 PM IST = 16:30 UTC → Smoke
    - cron: "30 16 * * *"

  workflow_dispatch:
    inputs:
      suite:
        description: "Which test suite to run?"
        required: true
        default: "smoke"

jobs:
  run-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install deps
        run: npm ci

      - name: Decide suite
        id: suite
        run: |
          if [ "${{ github.event_name }}" = "schedule" ]; then
            HOUR=$(date -u +"%H")
            MIN=$(date -u +"%M")

            if [ "$HOUR" = "09" ] && [ "$MIN" = "30" ]; then
              echo "SUITE=prod" >> $GITHUB_ENV
            elif [ "$HOUR" = "10" ] && [ "$MIN" = "30" ]; then
              echo "SUITE=regression" >> $GITHUB_ENV
            elif [ "$HOUR" = "16" ] && [ "$MIN" = "30" ]; then
              echo "SUITE=smoke" >> $GITHUB_ENV
            else
              echo "SUITE=smoke" >> $GITHUB_ENV
            fi
          else
            echo "SUITE=${{ github.event.inputs.suite }}" >> $GITHUB_ENV
          fi

      - name: Run tests
        run: |
          echo "Running suite: $SUITE"
          if [ "$SUITE" = "smoke" ]; then
            npx playwright test --grep @smoke
          elif [ "$SUITE" = "regression" ]; then
            npx playwright test --grep @regression
          elif [ "$SUITE" = "prod" ]; then
            npx playwright test --grep @prod
          fi
----------------------------------------------------------------------------------------------
https://playwright.dev/docs/ci-intro#setting-up-github-actions

.github/workflows/playwright.yml
name: Playwright Tests
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v5
    - uses: actions/setup-node@v5
      with:
        node-version: lts/*
    - name: Install dependencies
      run: npm ci
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps
    - name: Run Playwright tests
      run: npx playwright test
    - uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}
      with:
        name: playwright-report
        path: playwright-report/
        retention-days: 30
-----------------------------------------------------------------------------------------
Publishing report on the web
Downloading the HTML report as a zip file is not very convenient. However, we can utilize Azure Storage's static websites
hosting capabilities to easily and efficiently serve HTML reports on the Internet, requiring minimal configuration.
Create an Azure Storage account.
Enable Static website hosting for the storage account.
Create a Service Principal in Azure and grant it access to Azure Blob storage. Upon successful execution,
the command will display the credentials which will be used in the next step.

az ad sp create-for-rbac --name "github-actions" --role "Storage Blob Data Contributor" --scopes /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP_NAME>/providers/Microsoft.Storage/storageAccounts/<STORAGE_ACCOUNT_NAME>
Use the credentials from the previous step to set up encrypted secrets in your GitHub repository. Go to your repository's settings
, under GitHub Actions secrets, and add the following secrets:

AZCOPY_SPA_APPLICATION_ID
AZCOPY_SPA_CLIENT_SECRET
AZCOPY_TENANT_ID
For a detailed guide on how to authorize a service principal using a client secret, refer to this Microsoft documentation.

Add a step that uploads the HTML report to Azure Storage.

.github/workflows/playwright.yml
...
    - name: Upload HTML report to Azure
      shell: bash
      run: |
        REPORT_DIR='run-${{ github.run_id }}-${{ github.run_attempt }}'
        azcopy cp --recursive "./playwright-report/*" "https://<STORAGE_ACCOUNT_NAME>.blob.core.windows.net/\$web/$REPORT_DIR"
        echo "::notice title=HTML report url::https://<STORAGE_ACCOUNT_NAME>.z1.web.core.windows.net/$REPORT_DIR/index.html"
      env:
        AZCOPY_AUTO_LOGIN_TYPE: SPN
        AZCOPY_SPA_APPLICATION_ID: '${{ secrets.AZCOPY_SPA_APPLICATION_ID }}'
        AZCOPY_SPA_CLIENT_SECRET: '${{ secrets.AZCOPY_SPA_CLIENT_SECRET }}'
        AZCOPY_TENANT_ID: '${{ secrets.AZCOPY_TENANT_ID }}'


The contents of the $web storage container can be accessed from a browser by using the public URL of the website.
